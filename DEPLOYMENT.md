# Deployment Guide - Render with PostgreSQL

This guide will help you deploy the Timetable & Attendance System on Render with PostgreSQL.

## Prerequisites

1. A GitHub account
2. A Render account (free tier available)
3. Your code pushed to a GitHub repository

## Step 1: Prepare Your Repository

Ensure your repository contains these files:
- `app.py` - Main Flask application
- `wsgi.py` - WSGI entry point
- `requirements.txt` - Python dependencies
- `runtime.txt` - Python version
- `render.yaml` - Render configuration (optional)
- `init_db.py` - Database initialization script

## Step 2: Deploy on Render

### Option A: Using render.yaml (Recommended)

1. **Connect Repository:**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect the `render.yaml` file

2. **Automatic Setup:**
   - Render will create both the web service and PostgreSQL database
   - Environment variables will be automatically configured
   - The `DATABASE_URL` will be automatically linked

### Option B: Manual Setup

1. **Create PostgreSQL Database:**
   - Go to Render Dashboard
   - Click "New" → "PostgreSQL"
   - Choose "Free" plan
   - Note down the database credentials

2. **Create Web Service:**
   - Click "New" → "Web Service"
   - Connect your GitHub repository
   - Configure:
     - **Name:** `timetable-attendance-system`
     - **Environment:** `Python`
     - **Build Command:** `pip install -r requirements.txt`
     - **Start Command:** `gunicorn wsgi:app`

3. **Set Environment Variables:**
   - Go to your web service settings
   - Add these environment variables:
     ```
     SECRET_KEY=your-secret-key-here
     FLASK_ENV=production
     DATABASE_URL=postgresql://username:password@host:port/database_name
     ```
   - Copy the `DATABASE_URL` from your PostgreSQL service

## Step 3: Initialize Database

After deployment, you need to initialize the database with sample data:

1. **Access Render Shell:**
   - Go to your web service on Render
   - Click "Shell" tab
   - Run these commands:

```bash
# Initialize database with sample data
python init_db.py
```

## Step 4: Verify Deployment

1. **Check Health:**
   - Your app should be accessible at `https://your-app-name.onrender.com`
   - The health check should pass

2. **Test Login:**
   - Use demo accounts:
     - **Admin:** `admin` / `admin123`
     - **Faculty:** `faculty` / `faculty123`
     - **Student:** `student` / `student123`

## Environment Variables

### Required Variables:
- `SECRET_KEY` - Flask secret key (auto-generated by Render)
- `DATABASE_URL` - PostgreSQL connection string (auto-provided by Render)
- `FLASK_ENV` - Set to `production`

### Optional Variables:
- `PORT` - Port number (auto-set by Render)
- `HOST` - Host address (auto-set by Render)

## Database Migration

If you need to update the database schema:

1. **Local Development:**
   ```bash
   # Make changes to models in app.py
   # Test locally with SQLite
   python init_db.py
   ```

2. **Production:**
   ```bash
   # Access Render shell
   # Run initialization script
   python init_db.py
   ```

## Troubleshooting

### Common Issues:

1. **Build Failures:**
   - Check `requirements.txt` for correct dependencies
   - Ensure `runtime.txt` specifies a supported Python version

2. **Database Connection Errors:**
   - Verify `DATABASE_URL` is correctly set
   - Check if PostgreSQL service is running
   - Ensure database is initialized

3. **Application Errors:**
   - Check Render logs for error messages
   - Verify all environment variables are set
   - Test locally before deploying

### Logs and Monitoring:

- **View Logs:** Go to your web service → "Logs" tab
- **Health Checks:** Monitor the health check endpoint
- **Performance:** Use Render's built-in monitoring

## Security Considerations

1. **Environment Variables:**
   - Never commit sensitive data to Git
   - Use Render's environment variable management
   - Rotate secrets regularly

2. **Database Security:**
   - PostgreSQL on Render includes SSL encryption
   - Database credentials are automatically managed
   - Regular backups are included

3. **Application Security:**
   - Flask-Login handles session management
   - Passwords are hashed with bcrypt
   - CSRF protection is enabled

## Scaling

### Free Tier Limitations:
- 750 hours/month for web services
- 90 days for PostgreSQL databases
- 512MB RAM, 0.1 CPU

### Upgrading:
- Consider paid plans for production use
- Enable auto-scaling for high traffic
- Use dedicated PostgreSQL instances

## Support

- **Render Documentation:** [docs.render.com](https://docs.render.com)
- **Flask Documentation:** [flask.palletsprojects.com](https://flask.palletsprojects.com)
- **SQLAlchemy Documentation:** [docs.sqlalchemy.org](https://docs.sqlalchemy.org)

---

**Note:** The free tier of Render has limitations. For production applications, consider upgrading to a paid plan.
